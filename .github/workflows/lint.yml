name: lint
on: [push]

env:
  NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}
  NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY }}

# jobs:
# lint:
#   runs-on: ubuntu-latest
#   steps:
#     - uses: actions/checkout@v3
#     - uses: actions/setup-node@v3
#       with:
#         node-version: "16"
#     - run: npm i
#     - run: npm run lint
# deploy:
#   runs-on: ubuntu-latest
#   steps:
#     - uses: actions/checkout@v3
#     - uses: actions/setup-node@v3
#     - run: curl -X POST -d '{}' https://api.netlify.com/build_hooks/629b91f7c31fa21acc47f88b?trigger_branch=main
# deploy:
#   # needs: lint
#   name: "Deploy to Netlify"
#   runs-on: ubuntu-latest
#   steps:
#     - uses: actions/checkout@v3
#     - uses: actions/setup-node@v3
#       with:
#         node-version: "16"
#     - run: npm i
#     - run: npm run build
#     # Deploy to Netlify using our production secrets
#     - name: Deploy to netlify
#       uses: netlify/actions/cli@master
#       env:
#         NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
#         NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
#       with:
#         args: deploy --dir=.next --prod
#         secrets: '["NETLIFY_AUTH_TOKEN", "NETLIFY_SITE_ID"]'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      # Cache node modules and next folder
      - name: üì¨ Caching
        uses: actions/cache@v2
        with:
          path: |
            **/node_modules
            ${{ github.workspace }}/.next/cache
          key: ${{ runner.os }}-modules-${{ hashFiles('**/package-lock.json') }}

      - name: Use Node.js 16.x
        uses: actions/setup-node@v3
        with:
          node-version: 16.x

      - name: üß∞ Install dependencies
        run: npm run install

      - name: üì¶ Build project
        run: npm run build --if-present

      # - name: üßπ Run lint
      #   run: npm run lint

      # - name: üêõ Run tests
      #   run: npm run test

      # Deploy to Netlify with a personalized message
      - name: üöÄ Deploy to Netlify
        id: deploy-netlify
        uses: netlify/actions/cli@master
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
        with:
          args: deploy -m 'v${{ steps.package-version.outputs.current-version}} „Éª ${{ github.head_ref }}'
